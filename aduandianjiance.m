% 挖掘的话为350
% 敲击为180或者150

clear
clc
filename=[
%  '20170802123044_C1C2_32768_100000_2_8.dat';
% '20170802145345_C1C2_32768_100000_2_8.dat';
% '20170802145556_C1C2_32768_100000_2_8.dat';
% '20170802145807_C1C2_32768_100000_2_8.dat';
% '20170802150441_C1C2_32768_100000_2_8.dat';
% '20170802150651_C1C2_32768_100000_2_8.dat';
% '20170802151536_C1C2_32768_100000_2_8.dat';
% '20170802152209_C1C2_32768_100000_2_8.dat';
% '20170802152420_C1C2_32768_100000_2_8.dat';
% '20170802151747_C1C2_32768_100000_2_8.dat';
% '20170802152631_C1C2_32768_100000_2_8.dat';
% '20170802152842_C1C2_32768_100000_2_8.dat';   
% '20170802161839_C1C2_32768_100000_2_8.dat';  
% '20170802162050_C1C2_32768_100000_2_8.dat';
% '20170802162935_C1C2_32768_100000_2_8.dat';
% '20170802163146_C1C2_32768_100000_2_8.dat';
% '20170802164030_C1C2_32768_100000_2_8.dat';

'20170802164914_C1C2_32768_100000_2_8.dat';
'20170802165126_C1C2_32768_100000_2_8.dat'; 
'20170802164452_C1C2_32768_100000_2_8.dat';
'20170802164703_C1C2_32768_100000_2_8.dat';
'20170802125023_C1C2_32768_100000_2_8.dat';
'20170802124812_C1C2_32768_100000_2_8.dat';
'20170802125234_C1C2_32768_100000_2_8.dat';
'20170802125907_C1C2_32768_100000_2_8.dat';
'20170802130118_C1C2_32768_100000_2_8.dat';
'20170802130752_C1C2_32768_100000_2_8.dat';
'20170802131003_C1C2_32768_100000_2_8.dat';
'20170802150018_C1C2_32768_100000_2_8.dat';
'20170802150229_C1C2_32768_100000_2_8.dat';
'20170802150903_C1C2_32768_100000_2_8.dat';
'20170802151113_C1C2_32768_100000_2_8.dat';
'20170802151325_C1C2_32768_100000_2_8.dat';
'20170802151958_C1C2_32768_100000_2_8.dat';
'20170802153053_C1C2_32768_100000_2_8.dat';
'20170802162724_C1C2_32768_100000_2_8.dat';
'20170802162724_C1C2_32768_100000_2_8.dat';
'20170802163357_C1C2_32768_100000_2_8.dat';
'20170802163608_C1C2_32768_100000_2_8.dat';
'20170802163819_C1C2_32768_100000_2_8.dat';
'20170802164452_C1C2_32768_100000_2_8.dat';
'20170802164703_C1C2_32768_100000_2_8.dat';
'20170802164914_C1C2_32768_100000_2_8.dat';
'20170802165126_C1C2_32768_100000_2_8.dat';
'20170802165337_C1C2_32768_100000_2_8.dat';
'20170730100434_C1C2_32768_100000_2_8.dat';
'20170730100646_C1C2_32768_100000_2_8.dat';
'20170730100857_C1C2_32768_100000_2_8.dat';
'20170730101320_C1C2_32768_100000_2_8.dat';
'20170730101532_C1C2_32768_100000_2_8.dat';
'20170730101742_C1C2_32768_100000_2_8.dat';
'20170730101953_C1C2_32768_100000_2_8.dat';
'20170730102204_C1C2_32768_100000_2_8.dat';
'20170730102415_C1C2_32768_100000_2_8.dat';
'20170730102626_C1C2_32768_100000_2_8.dat';
'20170730102837_C1C2_32768_100000_2_8.dat';
'20170730103048_C1C2_32768_100000_2_8.dat';
'20170730103259_C1C2_32768_100000_2_8.dat';
'20170730103511_C1C2_32768_100000_2_8.dat';
'20170730103721_C1C2_32768_100000_2_8.dat';
'20170730103933_C1C2_32768_100000_2_8.dat';
'20170730104144_C1C2_32768_100000_2_8.dat';
'20170730104606_C1C2_32768_100000_2_8.dat';   
'20170730104355_C1C2_32768_100000_2_8.dat';
'20170730104817_C1C2_32768_100000_2_8.dat';
'20170730105239_C1C2_32768_100000_2_8.dat';
'20170730105701_C1C2_32768_100000_2_8.dat';
'20170730111008_C1C2_32768_100000_2_8.dat';
'20170730105028_C1C2_32768_100000_2_8.dat';
'20170730105239_C1C2_32768_100000_2_8.dat';
'20170730105450_C1C2_32768_100000_2_8.dat';
'20170730105701_C1C2_32768_100000_2_8.dat';
'20170730105913_C1C2_32768_100000_2_8.dat';
'20170730110124_C1C2_32768_100000_2_8.dat';
'20170730110334_C1C2_32768_100000_2_8.dat';
'20170730110545_C1C2_32768_100000_2_8.dat';
'20170730110757_C1C2_32768_100000_2_8.dat';
'20170730111008_C1C2_32768_100000_2_8.dat';
'20170730111218_C1C2_32768_100000_2_8.dat';];
[p,~]=size(filename);
pathname='H:\通道数据\';
for z=1:p
    name_file= filename(z,1:14);
    load([pathname name_file '.mat']);%中间有空格
    [m,n]=size(data_c1);
    state1=zeros(4096,200);%预先留内存大一点。
    state2=zeros(4096,200);%预先留内存大一点。
    for j=1:m
        data1=data_c1(j,:);%若以后这里用滤波函数要发生改变。
        [state_temp,seg]=ayuzhi2(data1,1.1);
        state1(j,1:seg)=state_temp;
        data2=data_c2(j,:);%若以后这里用滤波函数要发生改变。
        [state_temp,seg]=ayuzhi2(data2,1.1);
        state2(j,1:seg)=state_temp;
    end
    state=state1|state2;
    restate=zeros(4096,seg);
    for i=1:4096
        number=8;
        inc=8;
        redata=(enframe(state(i,1:seg),number,inc))';
        [~,m]=size(redata);
        data_sum=sum(redata);
        e=find(data_sum>=4);
        [~,b]=size(e);
        f=zeros(number,m);
        for j=1:b
            f(:,e(j))=ones(number,1);
        end
        restate(i,1:number*m)=reshape(f,1,number*m);
    end
    
    imagesc(restate);  %将矩阵中的元素按数值大小的不同转化成不同颜色，并在坐标轴上对应位置以这种颜色染色。
    colormap(flipud(gray));
    ylabel('1到4096点');xlabel('在130秒内发生入侵的时间')
    save(strcat('D:\处理数据\12.25图和mat\','a',num2str(name_file(1:14)),'.mat'),'state');
    saveas(gcf,strcat('D:\处理数据\12.25图和mat\','a',num2str(name_file(1:14)),'.tif'));
end

